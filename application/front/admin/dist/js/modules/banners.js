angular.module("Peaks.Banners",["Peaks.Banners.Services","Peaks.Banners.Directives","Peaks.Banners.Repositories"]),angular.module("Peaks.Banners.Services",[]),angular.module("Peaks.Banners.Directives",[]),angular.module("Peaks.Banners.Repositories",[]),angular.module("Peaks.Banners").controller("BannerEditCtrl",["$scope","$http","$stateParams",function($scope,$http,$stateParams){menuControl("banners"),$scope.section="banners/banners",$scope.backUrl="banners/zones/",$scope.tinymceOptions=tinymceConfig;var id=$stateParams.id,parent_id=$stateParams.parent_id;$scope.mode=id,"new"===id&&($scope.uploader={w:0,h:0,item_id:0,folder:"assets/images/banners/"+parent_id+"/",assetPath:"banners~"+parent_id,crop:1,uniqueName:!0});var getTheParent=function(){$http.get("/admin_banners/get_item/"+$scope.item.parent_id).success(function(data){$scope.parent=data.content_items,$scope.uploader.w=$scope.parent.width,$scope.uploader.h=$scope.parent.height})},getTheItem=function(){$http.get("/admin_banners/get_banner/"+id).success(function(data){$scope.item=data.content_items[0],$scope.backUrl="banners/zones/"+$scope.item.parent_id,$scope.uploader={w:0,h:0,item_id:0,folder:"assets/images/banners/"+$scope.item.parent_id+"/",assetPath:"banners~"+$scope.item.parent_id,crop:1,uniqueName:!0},init_page(),getTheParent()})};$scope.save=function(returnToParent){$scope.alert="Sauvegarde…",showAlert(),"new"===id&&($scope.item.parent_id=parent_id),console.log($scope.item),$http({url:"/admin_banners/update_banner",method:"POST",data:$scope.item,headers:{"Content-Type":"application/json"}}).success(function(data){console.log(data),returnToParent&&0===data.errors.length?window.location.hash="/banners/zones/"+$scope.item.parent_id:"new"===id&&0===data.errors.length?window.location.hash="/banners/banners/"+data.id:($scope.alert=data.message,$scope.errors=data.errors,showFadeAlert())}).error(function(){$scope.alert="Une erreure est survenue.",showFadeAlert()})},$scope.delete=function(){bootbox.confirm("Etes vous sur de vouloir supprimer cette bannière ?",function(result){result&&$http.get("/admin_banners/delete_banner/"+id).success(function(){window.location.hash="#/banners/zones/"+$scope.item.parent_id})})},"new"!=id?getTheItem():($scope.item={parent_id:parent_id},init_page(),getTheParent(),$scope.backUrl="banners/zones/"+$scope.item.parent_id)}]),angular.module("Peaks.Banners").controller("BannerZoneEditCtrl",["$scope","$http","$stateParams",function($scope,$http,$stateParams){$scope.section="banners",$scope.backUrl="banners/zones",menuControl("banners"),$scope.tinymceOptions={plugins:["autolink link image","searchreplace visualblocks code fullscreen","table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | link image"},init_page(),$scope.getView=function(id){window.location.hash="/banner-zones/banner/"+id,block()};var id=$stateParams.id;$scope.mode=id,$scope.editHide=!0,$scope.editShow=!1,$scope.assetsList={assetPath:"banners~"+id,editPath:"banners/banners/",controllerPath:"admin_banners/update_banner"};var getTheItem=function(){$http.get("/admin_banners/get_item/"+id).success(function(data){$scope.item=data.content_items,init_page()})},getTheMedia=function(){$http.get("/admin_banners/banner_list/"+id).success(function(data){$scope.assets=data})};$scope.save=function(returnToParent){$scope.alert="Sauvegarde…",showAlert(),$http({url:"/admin_banners/update_bannerzone",method:"POST",data:$scope.item,headers:{"Content-Type":"application/json"}}).success(function(data){console.log(data),returnToParent&&0===data.errors.length?window.location.hash="/banner-zones/list":"new"===id&&0===data.errors.length?window.location.hash="/banner-zones/edit/"+data.id:($scope.alert=data.message,$scope.errors=data.errors,showFadeAlert())}).error(function(){$scope.alert="Une erreure est survenue.",showFadeAlert()})},$scope.delete=function(){bootbox.confirm("Etes vous sur de vouloir supprimer cette bannière ?",function(result){result&&$http.get("/admin_banners/delete/"+id).success(function(){window.location.hash="/banner-zones/list"})})},"new"!=$scope.mode?(getTheItem(),getTheMedia()):($scope.hideForNew=!0,$scope.item={})}]),angular.module("Peaks.Banners").controller("BannerZoneListCtrl",["$scope","$http","$injector",function($scope,$http,$injector){var config={section:"banners/zones",menu:"banners",getUrl:"/admin_banners/bannerzone_list/",deleteUrl:"admin_banners/delete_bannerzone/"};$scope.table=[{title:"Nom",param:"name"},{title:"Nombre de bannières",param:"childs_count"}],$scope.pageTitle="Zones de bannière",$injector.invoke(ItemList,this,{$scope:$scope,$http:$http,config:config})}]);