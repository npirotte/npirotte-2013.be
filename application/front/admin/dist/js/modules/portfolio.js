angular.module("Peaks.Portfolio",["Peaks.Manager.Repositories","Peaks.Portfolio.Services","Peaks.Portfolio.Directives","Peaks.Portfolio.Repositories"]),angular.module("Peaks.Portfolio.Services",[]),angular.module("Peaks.Portfolio.Directives",[]),angular.module("Peaks.Portfolio.Repositories",[]),angular.module("Peaks.Portfolio").controller("PortfolioCategoryEditCtrl",["$scope","$stateParams","PortfolioCategoriesRepository","TagsRespository","ScopeCacheProvider",function($scope,$routeParams,portfolioCategoriesRepository,tagsRespository){menuControl("portfolio"),$scope.backUrl="portfolio/categories",init_page();var id=$routeParams.id;$scope.mode=id,$scope.select2Tags={multiple:!0,simple_tags:!0,tokenSeparators:[","],initSelection:function(){console.log(this)}},tagsRespository.tagNamesList(function(data){$scope.select2Tags.tags=data});var getTheItem=function(){portfolioCategoriesRepository.getCategory(id,function(data){$scope.item=data})};if($scope.save=function(returnToList){$scope.alert="Sauvegarde ...",showAlert(),portfolioCategoriesRepository.saveCategory($scope.item,function(data){returnToList&&0===data.errors.length?window.location.hash="/portfolio/categories":"new"===id&&0===data.errors.length?window.location.hash="/portfolio/categories/edit/"+data.id:($scope.alert=data.message,$scope.errors=data.errors,showFadeAlert())})},$scope.delete=function(){confirm("Etes vous sur de vouloir supprimer cette catégories ?")&&portfolioCategoriesRepository.deleteCategory(id,function(){window.location.hash="/portfolio/categories"})},"new"!=$scope.mode)getTheItem();else{$scope.hideForNew=!0,$scope.item={};for(var i=globalVars.siteLangages.length-1;i>=0;i--)$scope.item["meta_keywords_"+globalVars.siteLangages[i]]}}]),angular.module("Peaks.Portfolio").controller("PortfolioCategoriesListCtrl",["$scope","$http","$injector",function($scope,$http,$injector){var config={section:"portfolio/categories",menu:"portfolio",getUrl:"/admin_portfolio/categories_list/",deleteUrl:"admin_portfolio/category_delete/"};$scope.table=[{title:"Titre",param:"name_"+globalVars.defaultLanguage,strong:!0},{title:"Ordre",param:"weight"},{title:"Nombre déléments",param:"childs_count"}],$scope.pageTitle="Catégories de porfolios",$injector.invoke(ItemList,this,{$scope:$scope,$http:$http,config:config})}]),angular.module("Peaks.Portfolio").controller("PortfolioListCtrl",["$scope","$http","$injector",function($scope,$http,$injector){var config={section:"portfolio/portfolios",menu:"portfolio",getUrl:"/admin_portfolio/portfolio_list/",deleteUrl:"admin_portfolio/delete/"};$scope.table=[{title:"",param:"src",width:"60px"},{title:"Titre",param:"name",strong:!0},{title:"Nombre déléments",param:"childs_count"}],$scope.pageTitle="Galleries",$scope.thumbPath="portfolio",$injector.invoke(ItemList,this,{$scope:$scope,$http:$http,config:config})}]),angular.module("Peaks.Portfolio").controller("PortfolioEditCtrl",["$scope","$http","$stateParams","PortfolioCategoriesRepository","PortfolioItemsRepository","TagsRespository",function($scope,$http,$stateParams,portfolioCategoriesRepository,portfolioItemsRepository,tagsRespository){$scope.section="portfolio/portfolios",menuControl("portfolio"),$scope.tinymceOptions=tinymceConfig,init_page();var id=$stateParams.id;$scope.mode=id,$scope.editHide=!0,$scope.editShow=!1,$scope.uploader={w:300,h:300,item_id:id,folder:"assets/images/portfolio/"+id+"/thumbs/",assetPath:"portfolio~"+id+"~thumbs",crop:1,uniqueName:!0},$scope.assetsList={folder:"assets/images/portfolio/"+id+"/",assetPath:"portfolio~"+id,parentIdentity:"portfolio_item"},$scope.select2Tags={multiple:!0,simple_tags:!0,tokenSeparators:[","],initSelection:function(){console.log(this)}},tagsRespository.tagNamesList(function(data){$scope.select2Tags.tags=data}),portfolioCategoriesRepository.categoriesList(function(categories){console.log(categories),$scope.categories=categories.items}),$scope.createNewCategoty=function(){$scope.alert="Création de la catégories",showAlert(),portfolioCategoriesRepository.saveCategory($scope.newCategory,function(data){$scope.categories.push({id:data.id,name:data.name}),$scope.alert=data.message,showFadeAlert()})};var getTheItem=function(){portfolioItemsRepository.getItem(id,function(data){var temp={};angular.forEach(data.categories,function(category){temp[category.parent_id]=!0}),data.categories=temp,$scope.item=data,console.log($scope.item)})};$scope.save=function(returnToList){$scope.alert="Sauvegarde…",showAlert(),console.log($scope.item),portfolioItemsRepository.saveItem($scope.item,function(data){returnToList&&0===data.errors.length?window.location.hash="/portfolio/portfolios":"new"===id&&0===data.errors.length?window.location.hash="/portfolio/portfolios/edit/"+data.id:($scope.alert=data.message,$scope.errors=data.errors,showFadeAlert(),getTheItem())})},$scope.delete=function(){bootbox.confirm("Etes vous sur de vouloir supprimer cet élément ?",function(invoke){invoke&&$http.get("/admin_portfolio/delete/"+id).success(function(){window.location.hash="/portfolio/portfolios"})})},"new"!=$scope.mode?getTheItem():($scope.hideForNew=!0,$scope.item={categories:{}},angular.forEach(globalVars.siteLangages,function(lang){$scope.item["meta_keywords_"+lang]=[]}))}]),angular.module("Peaks.Portfolio.Repositories").factory("PortfolioCategoriesRepository",["$http",function($http){var categoriesCache=!1;return{categoriesList:function(callback){categoriesCache&&callback(categoriesCache),$http.get("/admin_portfolio/categories_list").success(function(data){callback(data),categoriesCache=data})},getCategory:function(id,callback){$http.get("/admin_portfolio/category_details/"+id).success(function(data){callback(data)})},saveCategory:function(data,callback){$http({url:"/admin_portfolio/category_edit",method:"POST",data:data,headers:{"Content-Type":"application/json"}}).success(function(data){console.log(data),callback(data)}).error(function(){alert="Une erreure est survenue."})},deleteCategory:function(id,callback){$http.get("/admin_portfolio/category_delete/"+id).success(function(data){callback(data)})}}}]),angular.module("Peaks.Portfolio.Repositories").factory("PortfolioItemsRepository",["$http",function($http){return{getItem:function(id,callback){$http.get("/admin_portfolio/item_details/"+id).success(function(data){callback(data)})},saveItem:function(data,callback){$http({url:"/admin_portfolio/item_edit",method:"POST",data:data,headers:{"Content-Type":"application/json"}}).success(function(data){console.log(data),callback(data)}).error(function(){alert="Une erreure est survenue."})},deleteItem:function(id,callback){$http.get("/admin_portfolio/item_delete/"+id).success(function(data){callback(data)})}}}]);